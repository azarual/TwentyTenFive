TO-DO

- Write Download section
- Write Conclusion
- Set up basic download page
- Screenshot of Twenty Ten
- Screenshot of caption


HTML5 has a logo. It's official. And when anything has a logo you know it's hit the mainstream. But in a recent survey by Chris Coyier over at CSS Tricks almost two-thirds of respondents said they would not use HTML5 in new projects. This is depressing reading. Perhaps developers and designers are scared away by cross-browser compatibility and learning new markup. And possibly the logo too. The truth is that with a pinch of JavaScript HTML5 can be used safely, today, across all browsers back to IE6.

Now before I go on I want to make clear that I have made an assumption: that you don't need convincing to use HTML5. You understand the benefits and you are eager to work with it. It is out of the scope of this article to explain why HTML5 is a natural progressive step you can take today, but if you still need to see the arguments then check out:

    * Learning to Love HTML5
    * Five Reasons Why You Can Use HTML5 Today
    * HTML5 And The Future Of The Web


HTML5 & JavaScript

HTML5 is many things, but what it's not is just adding <doctype html> at the start of your file and getting excited that you're so 2011. Markup, as they say, is meaning, and HTML5 brings with it a whole bunch of meaning to your documents.

Which brings us to WordPress. Last year WordPress launched arguably their biggest update ever: WordPress 3.0. And with it came a new theme called TwentyTen, and the promise of a new theme every year.

TwentyTen is a fine theme, and whilst it's design might not be suitable for many sites it already validates as HTML5. However, in order to cater for users without JavaScript TwentyTen has to forgo a large chunk of HTML5 elements because Internet Explorer doesn't support them prior to version 9.

For example, you have probably already heard of <section> and <article> tags, both of which are champing at the bit to embed themselves into a WordPress template. However, to use these HTML5 elements in IE8 (and it's ancestors) you need JavaScript to create them in the DOM; if you don't they can't be styled with CSS. Turn off JavaScript and you turn off styles on these elements; invariably this will ‘break' your page.

My assumption is that WordPress made the decision to exclude these problematic tags so that it's default theme supports all browsers, not just those with JavaScript turned on.

Whilst I understand this decision I also think it's a mistake. I believe that there are three core technologies that make the web work: HTML, CSS and JavaScript. All desktop browsers support them (to some degree) so if a user chooses to turn any one of these off they must expect a degraded experience. JavaScript is now fundamental to user experience, and whilst we can support users with JavaScript turned off I question whether we should.

There is compelling evidence from Yahoo! that less than 1.5% of it's users turn off JavaScript. My own research into this phenomenon, ably assisted by Greig Daines at eConversions, suggests this number to be below 0.5% (based on millions of visitors to a UK retail site).

As soon as we stop supporting users with JavaScript disabled we are able to embrace all elements of HTML5, together with CSS3 and media-queries as well!

To make TwentyTen play fair with IE I suggest Remy Sharp's HTML5 shim or, if you also want to sink your teeth into CSS3, Modernizr. Modernizr not only adds support for HTML5 elements but also let's you know which CSS3 properties are supported by the users browser.

So let's assume you've smartly banished non-JavaScript users with polite message in a <noscript> tag; we can now start to tinker under the hood of TwentyTen and bring some real HTML5 goodness to WordPress.


HTML5 Ready

There are a number of things that TwentyTen has spot on. First of all, it declares the right doctype and includes the abbreviated meta charset tag. We can also see the liberal use of micro-formats in the <head>, and use of WAI-ARIA roles throughout the theme. However we can go further.

Important notes

    * I am referencing the HTML generated at http://wp-themes.com/twentyten/ rather than just the simple ‘Hello World' clean install of WordPress3.
    * In this article I edit the files directly in the /wp-content/themes/twentyten directory. However, these files could be accidentally overwritten so in the download link at bottom of the article you can download a child theme.
    * Line numbers may change over time, so when I reference a specific line number I usually say 'on or around line...'.


Articles

Perhaps the most confusing parts of the HTML5 spec is that of <section> and <article> tags. Which came first, the chicken or the egg? The easiest way to remember this is to refer to the spec. Now the HTML5 spec is a dry document at the best of times, but it's explanation of <article>'s should always point you in the right direction:

    “The article element represents a self-contained composition in a document, page, application or site that is intended to be independently distributable or reusable.”

If the piece of content in question can be, and most likely will be, syndicated by RSS then there's a good chance it's an <article>; a blog post in WordPress exactly fits this bill.

In the case of the TwentyTen homepage we have the following HTML wrapped around a blog post:

<div id="post-19">
...
</div>

To a screenreader or a spider it means, basically, nothing. However, with the simple addition of an article tag we're now able to transform this into markup with meaning.

<article id="post-19">
...
</article>

Note we still retain the id to make this article unqiue.

To make this change in the TwentyTen theme you need to open loop.php in /wp-content/themes/twentyten/. On or around line 60 you should find the following code:

<div id="post-<?php the_ID(); ?>" <?php post_class(); ?>>

We need to change that <div> to an <article> so it reads:

<article id="post-<?php the_ID(); ?>" <?php post_class(); ?>>

and then close it again on or around line 96 so that:

</div><!-- #post-## -->

becomes

</article><!-- #post-## -->

So far, so good. It's a simple change but one that has already overhauled the semantics of your page. But we can do more…

Time & Date

We can now give the date and time that the article was published more content with HTML5's <time> tag. Take a look at the following code from our example above:

<a href="http://wp-themes.com/?p=19" title="4:33 am" rel="bookmark"><span>October 17, 2008</span></a>

We can give our markup meaning by transposing this to

<a href="http://wp-themes.com/?p=19" title="4:33 am" rel="bookmark"><time datetime= "2008-10-17T04:33Z" pubdate>October 17, 2008</time></a>


According to the HTML5 spec,

    “The <time> element either represents a time on a 24-hour clock, or a precise date on the Proleptic Georgian calendar, optionally with a time and a time-zone offset.”

We can utilise this element then to explicitly say when our article was published - this time is now machine-readable and should we wish there are many ways our browser could then interact with this date. I've also added in the boolean attribute ‘pubdate' which designates this date as the date the article/content was published.

To change our WordPress code the first thing we need to include is the date and time itself. The time is optional, but since WordPress includes when you post a blog article we can too. To implement this into WordPress involves us digging a little deeper. In loop.php the date is included by calling the function:

<?php twentyten_posted_on(); ?>

If we want to make our HTML5 changes we need to head over to /wp-content/themes/twentyten/functions.php and scroll down to around line 500 where we'll see:

function twentyten_posted_on() {
printf( __( '<span>Posted on</span> %2$s <span>by</span> %3$s', 'twentyten' ),
'meta-prep meta-prep-author',
sprintf( '<a href="%1$s" title="%2$s" rel="bookmark"><span>%3$s</span></a>',
get_permalink(),
esc_attr( get_the_time() ),
get_the_date()
),

If you don't know what that means then don't worry. We're only focussing on the sprintf command which basically takes a string and inserts the variables returned by the three functions listed: get_permanlink(), get_the_time() and get_the_date() are inserted into %1$s, %2$s and %3$s respectively.

We need to make changes to how the date is formatted, so we need to add a fourth function: get_the_date('c'). WordPress will return the date in Coordinated Universal Time (UTC) format which is exactly what's needed for the <time> element. We also ammend

esc_attr( get_the_time() )

to

esc_attr( get_the_time('H:i') )

which returns the time in 24-hour clock with leading zeros. Our finished code looks like this:

printf( __( '<span>Posted on</span> %2$s <span>by</span> %3$s', 'twentyten' ),
'meta-prep meta-prep-author',
sprintf( '<a href="%1$s" title="%2$s" rel="bookmark"><time datetime="%3$s" pubdate>%4$s</time></a>',
get_permalink(),
esc_attr( get_the_time('H:i') ),
get_the_date('c'),
get_the_date()
),

I've have included get_the_date() twice as we need two different formats: one for the <time> element and one that's displayed to the user.

For more details on the WordPress date/time functions check out:

    * http://codex.wordpress.org/Function_Reference/get_the_time
    * http://codex.wordpress.org/Formatting_Date_and_Time
    

Figures

A figure, for our purposes at least, is a piece of media that you might upload to WordPress and then include in a post; the most obvious example of which would be an image.
The spec defines <figure> as follows:

    “The figure element represents a unit of content, optionally with a caption, that is self-contained, that is typically referenced as a single unit from the main flow of the document, and that can be moved away from the main flow of the document without affecting the document's meaning.”

WordPress3 is helpful enough to give images a caption but it doesn't do so using the new HTML5 <figure> tag. Currently an img with a caption will be rendered like so:

<div style="width: 445px"><img alt="Boat" src="http://wpdotorg.files.wordpress.com/2008/11/boat.jpg" title="Boat" width="435" height="288" />
<p>Boat</p>
</div>


To change this HTML to include HTML5 elements we need to first look at media.php in the wp-inlcudes directory, which is where this code is generated. On or around line 739 you'll find:

return '<div ' . $id . 'class="wp-caption ' . esc_attr($align) . '" style="width: ' . (10 + (int) $width) . 'px">'
. do_shortcode( $content ) . '<p>' . $caption . '</p></div>';

What we need to do is define a new function which outputs our <figure> based HTML and assign this function to the same shortcode that calls img_caption_shortcode(). I've done this in /wp-content/themes/twentyten/functions.php by adding the following:

add_shortcode('wp_caption', 'twentyten_img_caption_shortcode');
add_shortcode('caption', 'twentyten_img_caption_shortcode');

function twentyten_img_caption_shortcode($attr, $content = null) {

// Allow plugins/themes to override the default caption template.
$output = apply_filters('img_caption_shortcode', '', $attr, $content);
if ( $output != '' )
return $output;

extract(shortcode_atts(array(
'id'    => '',
'align'    => 'alignnone',
'width'    => '',
'caption' => ''
), $attr));

if ( 1 > (int) $width || empty($caption) )
return $content;

if ( $id ) $id = 'id="' . esc_attr($id) . '" ';

return '<figure ' . $id . 'class="wp-caption ' . esc_attr($align) . '" style="width: ' . (10 + (int) $width) . 'px">'
. do_shortcode( $content ) . '<figcaption>' . $caption . '</figcaption></figure>';

}

First we point the shortcodes for wp-caption and caption to our new function twentyten_img_caption_shortcode(). Then we simply copy the original function from media.php and change the last few lines to include our <figure> element. This will now render our boat.jpg example from above like so:

<figure id="attachment_64" style="width: 445px;">
<a href="http://localhost/wp-content/uploads/2010/07/boat.jpg"><img title="boat" src="http://localhost/wp-content/uploads/2010/07/boat.jpg" alt="" width="435" height="288"></a>
<figcaption>Boat</figcaption>
</figure>



Header, Navigation & Footer

Finally we can take a look at inserting the new <header>, <nav> and <footer> tags. Currently the code in /wp-content/themes/twentyten/header.php looks more or less like this:

<div id="header">
<div id="masthead">
<div id="branding" role="banner">
...
</div><!-- #branding -->

<div id="access" role="navigation">
...
</div><!-- #access -->
</div><!-- #masthead -->
</div><!-- #header -->

It doesn't take a genius to see that we can easily make this HTML5 ready by changing some of those divs.

<header id="header">
<section id="masthead" >
<div id="branding" role="banner">
...
</div><!-- #branding -->

<nav id="access" role="navigation">
...
</nav><!-- #access -->
</section><!-- #masthead -->
<header><!-- #header -->

You can see that we've still left the WAI-ARIA role of ‘navigation' assigned to the nav element, and this is simply to offer the broadest support to all browsers and screen-readers.

I have replaced the #masthead div with a section, as all the elements within this section relate to one-another (you could delete this section altogether and just apply 30px of top-padding to header to maintain the same layout). Likewise, I've maintained the elements IDs in case there is more than one instance of them on the page; multiple headers, footers and navs (amongst others) are all welcome on a HTML5 page.

Likewise in /wp-content/themes/twentyten/footer.php we have

<div id="footer" role="contentinfo">
  <div id="colophon">
  ...
  <div id="site-info">
    <a href="<?php echo home_url( '/' ) ?>" title="<?php echo esc_attr( get_bloginfo( 'name', 'display' ) ); ?>" rel="home">
    <?php bloginfo( 'name' ); ?>
    </a>
  </div><!-- #site-info -->

  <div id="site-generator">
  ...
  </div><!-- #site-generator -->

  </div><!-- #colophon -->
</div><!-- #footer -->

Which can easily be changed to:

<footer role="contentinfo">
  <section id="colophon">
  ...
  <div id="site-info">
    <a href="<?php echo home_url( '/' ) ?>" title="<?php echo esc_attr( get_bloginfo( 'name', 'display' ) ); ?>" rel="home">
    <?php bloginfo( 'name' ); ?>
    </a>
  </div><!-- #site-info -->

  <div id="site-generator">
  ...
  </div><!-- #site-generator -->

  </section><!-- #colophon -->
</div><!-- #footer -->



Javascript & CSS

As mentioned earlier we should include Modernizr.js to make sure all our new elements render correctly in Internet Explorer. I add the following line to header.php:

<script src="<?php bloginfo('stylesheet_directory'); ?>/js/Modernizr-1.6.min.js"></script>

There are a couple of things worth noting here. Firstly that we no longer need type=”text/javascript”, because browsers assume a script is JavaScript unless they're told differently. Second, we need to use the WordPress bloginfo() function to point the source URL at our theme directory (I use 'sylesheet_directory' as I'm creating a child theme - check out the download section below for more details).

Although part of the reason we include Modernizr is to make sure IE  can deal with new HTML5 elements, I serve it to all browsers because of the CSS3 checking functionality it also adds.

Next, in style.css we need to make sure that our HTML5 elements have display: block assigned to them. For our purposes the following line will suffice:

header, nav, section, article, aside, figure, footer { display: block; }

Whilst we're looking at the CSS it's worth remembering that we can now remove type=”text/css” from our <link /> tags. The simplified code looks like:

<link rel="stylesheet" href="<?php bloginfo( 'stylesheet_url' ); ?>" />

That should be enough for now, but remember that changing the structure of the page by replacing older HTML elements with new ones might require some additional CSS.

As we've stopped supporting browsers with JavaScript turned off it's worth letting this small minority of users know. A polite message just below the opening <body> tag should suffice:

<noscript><strong>Sorry, but you need to turn JavaScript on to use this site. <a href="http://turnjavascripton.com" target="_blank">Find out how...</a></strong></noscript>

A some very basic CSS in style.css makes this message unmissable.

/* A message for users with JavaScript turned off */
noscript strong {display: block; font-size: 18px; line-height:1.5em; padding: 5px 0; background-color: #ccc; color: #a00; text-align: center; }


Final Thoughts

TwentyTen was a huge step forward for WordPress, and as a piece of HTML it is a beacon a best practice. However, by 

Whilst we address a good number of new HTML5 elements in this piece, there are many more you could add yourself. Do let us know your ideas, and how you get on implementing them in the comments!

If you make your changes in twentyten and update WordPress it can overwrite them!

Download


Other Resources

You may be interested in the following articles and related resources